<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LifeSafe • V1.21g-Light</title>
  <link rel="icon" href="favicon.svg" />
  <link rel="stylesheet" href="styles.css?v=121gL" />
</head>
<body>
  <div id="splash" class="splash">
    <div class="logo">LifeSafe</div>
    <div class="tag">Your household hub</div>
    <div class="ver">Version <strong>1.21g</strong> • Light</div>
    
<div id="splashGate" class="softGate" style="display:block">
  <h4>Sign in to store safely (recommended)</h4>
  <p>Sign in before you start so your records and uploads can be accessed across devices. Or continue as Guest (device‑only) and sign in later.</p>
  <div class="row">
    <input id="splashEmail" type="email" placeholder="Email for sign-in link" autocomplete="email" />
    <button id="splashEmailBtn" class="btn ghost" type="button">Send sign-in link</button>
    <button id="splashGoogleBtn" class="btn ghost" type="button">Sign in with Google</button>
    <button id="splashGuestBtn" class="btn secondary" type="button">Continue as Guest</button>
  </div>
  <div class="tinyNote" id="splashNote">If buttons are greyed out, wait a moment for sign-in to finish loading. Guest works immediately.</div>
</div>
<script>
  // Splash fallback (v1.21f): buttons always visible; handlers wait for auth readiness.
  (function(){
    function proceed(){ try{ document.getElementById('splash').classList.add('hidden'); document.getElementById('main').classList.remove('hidden'); }catch(e){} }
    function guest(){
      var ok = confirm('Continue as Guest?

Data will be private to this device until you sign in. If you switch device or clear browser data you may lose access.

You can sign in later to link and keep your data.');
      if(ok){
        try{ localStorage.setItem('lifesafe_guest_confirmed','1'); }catch(e){}
        proceed();
      }
    }
    function status(msg){
      var n=document.getElementById('splashNote');
      if(n) n.textContent = msg;
    }
    function emailClick(){
      var email = (document.getElementById('splashEmail')||{}).value || '';
      email = email.trim();
      if(!email) return alert('Enter an email address first.');
      if(typeof window.lifesafeSendEmailLink === 'function'){
        window.lifesafeSendEmailLink(email);
      }else{
        status('Sign-in is still loading… try again in a moment (or continue as Guest).');
        alert('Sign-in still loading. Please try again in a moment.');
      }
    }
    function googleClick(){
      if(typeof window.lifesafeGoogleSignIn === 'function'){
        window.lifesafeGoogleSignIn();
      }else{
        status('Sign-in is still loading… try again in a moment (or continue as Guest).');
        alert('Sign-in still loading. Please try again in a moment.');
      }
    }

    document.addEventListener('DOMContentLoaded', function(){
      var guestBtn=document.getElementById('splashGuestBtn');
      var emailBtn=document.getElementById('splashEmailBtn');
      var googleBtn=document.getElementById('splashGoogleBtn');
      if(guestBtn) guestBtn.addEventListener('click', guest);
      if(emailBtn) emailBtn.addEventListener('click', emailClick);
      if(googleBtn) googleBtn.addEventListener('click', googleClick);
      status('Loading sign-in… You can continue as Guest now.');
      // If they already confirmed Guest previously, enter immediately
      try{
        if(localStorage.getItem('lifesafe_guest_confirmed')==='1') proceed();
      }catch(e){}
    });
  })();
</script>

</div>

  <div id="main" class="app hidden">
    <header class="appbar">
      <div class="brand"><img src="favicon.svg" class="ico" alt=""/><span>LifeSafe</span></div>
      <div class="title" id="activeTitle">Home</div>
      <div></div>
    </header>

    <nav id="tabs" class="tabs"></nav>

    <section class="content">
      <div id="homeContent">
        <div class="banner hidden" id="homeBanner"></div>
        <div class="toolbar"><button class="btn primary" id="addBtnHome">+ Add Record</button></div>
        <div id="homeHint" class="hint">Start by adding your first record.</div>
        <div id="homeList" class="list"></div>
      </div>

      <div id="vehiclesContent" class="hidden">
        <div class="banner hidden" id="vehiclesBanner"></div>
        <div class="toolbar"><button class="btn primary" id="addBtnVehicles">+ Add Record</button></div>
        <div id="vehiclesHint" class="hint">Add MOT, insurance, tax, etc.</div>
        <div id="vehiclesList" class="list"></div>
      </div>

      <div id="healthContent" class="hidden">
        <div class="banner hidden" id="healthBanner"></div>
        <div class="toolbar"><button class="btn primary" id="addBtnHealth">+ Add Record</button></div>
        <div id="healthHint" class="hint">Add prescriptions, checkups, etc.</div>
        <div id="healthList" class="list"></div>
      </div>

      <div id="financeContent" class="hidden">
        <div class="banner hidden" id="financeBanner"></div>
        <div class="toolbar"><button class="btn primary" id="addBtnFinance">+ Add Record</button></div>
        <div id="financeHint" class="hint">Add insurance, bills, cards, etc.</div>
        <div id="financeList" class="list"></div>
      </div>

      <div id="idsContent" class="hidden">
        <div class="banner hidden" id="idsBanner"></div>
        <div class="toolbar"><button class="btn primary" id="addBtnIds">+ Add Record</button></div>
        <div id="idsHint" class="hint">Add passport, licence, certificates, etc.</div>
        <div id="idsList" class="list"></div>
      </div>

      <div id="petsContent" class="hidden">
        <div class="banner hidden" id="petsBanner"></div>
        <div class="toolbar"><button class="btn primary" id="addBtnPets">+ Add Record</button></div>
        <div id="petsHint" class="hint">Add vaccinations, insurance, vet, etc.</div>
        <div id="petsList" class="list"></div>
      </div>

      <div id="otherContent" class="hidden">
        <div class="banner hidden" id="otherBanner"></div>
        <div class="toolbar"><button class="btn primary" id="addBtnOther">+ Add Record</button></div>
        <div id="otherHint" class="hint">Add anything else you want to track.</div>
        <div id="otherList" class="list"></div>
      </div>

      <div id="uploadsContent" class="hidden">
        <div class="banner" id="uploadsBanner">
          Uploads hub: stored securely in Firebase (your device only).
          <div class="smallNote" id="authStatus">Firebase auth: loading…</div>
          <div class="smallNote" id="authStatus2"></div>
        </div>
        <div class="toolbar">
          <input id="filePicker" type="file" multiple class="hidden" />
          <button class="btn primary" id="addBtnUploads">+ Add Document</button>
        </div>
        <div id="uploadsHint" class="hint">Add scans/photos of policies, MOTs, certificates, etc.</div>
        <div id="uploadsList" class="list"></div>
      </div>
    </section>
  </div>

  <div id="detail" class="detail hidden">
    <header class="appbar">
      <button id="backBtn" class="btn ghost">← Back</button>
      <div class="title">Details</div>
      <div></div>
    </header>
    <div class="detailWrap" id="detailWrap"></div>
    <div class="detailActions">
      <button id="calendarFromDetail" class="btn ghost">Add Reminder to Calendar</button>
      <button id="editFromDetail" class="btn ghost">Edit</button>
      <button id="deleteFromDetail" class="btn danger">Delete</button>
    </div>
  </div>

  <div id="overlay" class="overlay hidden"></div>
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modalHeader">
      <div class="modalTitle" id="modalTitle">Add Record</div>
      <button id="closeModal" class="btn icon" aria-label="Close">✕</button>
    </div>
    <div class="modalBody">
      <label>Title<input id="fTitle" type="text" placeholder="e.g., Home Insurance" /></label>
      <label>Type<input id="fType" type="text" placeholder="e.g., Renewal, Insurance, MOT" /></label>
      <label>Description<textarea id="fDesc" rows="3" placeholder="Notes…"></textarea></label>
      <div class="grid2">
        <label>Start Date<input id="fStart" type="date" /></label>
        <label>Renewal Date<input id="fRenewal" type="date" /></label>
      </div>
    </div>
    <div class="modalActions">
      <button id="saveRecord" class="btn primary">Save</button>
    </div>
  </div>

  <div id="confirmOverlay" class="overlay hidden"></div>
  <div id="confirmPopup" class="confirm hidden" role="dialog" aria-modal="true">
    <div class="confirmHeader">
      <span class="warnIcon">⚠️</span>
      <span>Delete this record?</span>
    </div>
    <div class="confirmBody">
      This will permanently remove it. Any calendar reminders won’t be removed automatically.
    </div>
    <div class="confirmActions">
      <button id="confirmCancel" class="btn ghost">Cancel</button>
      <button id="confirmDelete" class="btn danger">Delete</button>
    </div>
  </div>

  <!-- Firebase compat builds (reliable on GitHub Pages + iPhone Safari) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-check-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>window.LIFESAFE_FIREBASE_CONFIG = {"apiKey": "AIzaSyDALDniDAfnsux6QRNFBaUL2yPSPrV3kpA", "authDomain": "lifesafe-v1-15.firebaseapp.com", "projectId": "lifesafe-v1-15", "storageBucket": "lifesafe-v1-15.firebasestorage.app", "messagingSenderId": "858805693168", "appId": "1:858805693168:web:788a7dcefa10514378b035"};</script>
  <script src="app.js?v=121gL"></script>
</body>
</html>
